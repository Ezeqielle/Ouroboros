# Migration `20200929001757-rework-db-add-discord_name`

This migration has been generated by mathis di mascio at 9/29/2020, 12:17:57 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `ouroboros`.`User` (
`id` int NOT NULL  AUTO_INCREMENT,
`discord_id` varchar(191) NOT NULL ,
`discord_name` varchar(191) NOT NULL ,
`blizzard_token` varchar(191) NOT NULL ,
`status` int NOT NULL DEFAULT 1,
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
`updatedAt` datetime(3) NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ouroboros`.`Balance` (
`id` int NOT NULL  AUTO_INCREMENT,
`amount` int NOT NULL DEFAULT 0,
`userId` int  ,
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
`updatedAt` datetime(3) NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ouroboros`.`Character` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL ,
`server` varchar(191) NOT NULL ,
`wow_id` varchar(191) NOT NULL ,
`class` varchar(191) NOT NULL ,
`userId` int NOT NULL ,
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
`updatedAt` datetime(3) NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ouroboros`.`Role` (
`id` int NOT NULL  AUTO_INCREMENT,
`heal` int NOT NULL DEFAULT 0,
`tank` int NOT NULL DEFAULT 0,
`dps` int NOT NULL DEFAULT 0,
`characterId` int NOT NULL ,
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
`updatedAt` datetime(3) NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ouroboros`.`Boost` (
`id` int NOT NULL  AUTO_INCREMENT,
`type` int NOT NULL ,
`pot` int NOT NULL ,
`adv` varchar(191) NOT NULL ,
`userId` int NOT NULL ,
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `User.discord_id` ON `ouroboros`.`User`(`discord_id`)

CREATE UNIQUE INDEX `Balance_userId` ON `ouroboros`.`Balance`(`userId`)

CREATE UNIQUE INDEX `Role_characterId` ON `ouroboros`.`Role`(`characterId`)

ALTER TABLE `ouroboros`.`Balance` ADD FOREIGN KEY (`userId`) REFERENCES `ouroboros`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `ouroboros`.`Character` ADD FOREIGN KEY (`userId`) REFERENCES `ouroboros`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ouroboros`.`Role` ADD FOREIGN KEY (`characterId`) REFERENCES `ouroboros`.`Character`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ouroboros`.`Boost` ADD FOREIGN KEY (`userId`) REFERENCES `ouroboros`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200914233618-edit-balance..20200929001757-rework-db-add-discord_name
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -12,8 +12,9 @@
 model User {
   id                Int         @default(autoincrement()) @id
   discord_id        String      @unique
+  discord_name      String
   blizzard_token    String      
   status            Int         @default(1)
   characters        Character[]
   balance          Balance
```


